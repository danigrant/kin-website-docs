<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Example ViewController · Kin SDK Docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;pre&gt;&lt;code class=&quot;hljs css language-swift&quot;&gt;&lt;/code&gt;&lt;/pre&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Example ViewController · Kin SDK Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://kinecosystem.github.io/kin-website-docs/index.html"/><meta property="og:description" content="&lt;pre&gt;&lt;code class=&quot;hljs css language-swift&quot;&gt;&lt;/code&gt;&lt;/pre&gt;
"/><meta property="og:image" content="https://kinecosystem.github.io/kin-website-docs/img/kin.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://kinecosystem.github.io/kin-website-docs/img/kin.svg"/><link rel="shortcut icon" href="/kin-website-docs/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-130210113-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/kin-website-docs/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/kin-website-docs/js/code-block-buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/kin-website-docs/css/main.css"/><script src="/kin-website-docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/kin-website-docs/"><img class="logo" src="/kin-website-docs/img/logo-clear-k.svg" alt="Kin SDK Docs"/><h2 class="headerTitleWithLogo">Kin SDK Docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/kinecosystem/kin-website-docs/tree/master/docs/quick-start/code-view-controller-ios.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Example ViewController</h1></header><article><div><span><pre><code class="hljs css language-swift"><span class="hljs-comment">//</span>
<span class="hljs-comment">//  ViewController.swift</span>
<span class="hljs-comment">//  KinHelloWorld</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//  Copyright © 2019 Kin Ecosystem. All rights reserved.</span>
<span class="hljs-comment">//</span>

<span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> KinSDK

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">UIViewController</span> </span>{

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.viewDidLoad()
        
        <span class="hljs-comment">// Initialize the Kin client on the playground blockchain</span>
        <span class="hljs-keyword">let</span> kinClient: <span class="hljs-type">KinClient!</span> = initializeKinClientOnPlaygroundNetwork()

        <span class="hljs-comment">// The Kin Account we're going to create and use</span>
        <span class="hljs-keyword">var</span> account: <span class="hljs-type">KinAccount!</span> = <span class="hljs-literal">nil</span>

        <span class="hljs-comment">// This deletes any stored account so that we recreate one</span>
        deleteFirstAccount(kinClient: kinClient)

        <span class="hljs-comment">// Get any stored existing user account</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> existingAccount = getFirstAccount(kinClient: kinClient) {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Current account with address \(existingAccount.publicAddress)"</span>)
            account = existingAccount
        }
        <span class="hljs-comment">// or else create an account with the client</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> newAccount = createLocalAccount(kinClient: kinClient) {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Created account with address \(newAccount.publicAddress)"</span>)
            account = newAccount
        }

        <span class="hljs-comment">// Watch for the creation of the account</span>
        watchCreation(forAccount: account)

        <span class="hljs-comment">// Watch for changes in the balance of the account</span>
        watchBalance(forAccount: account)

        <span class="hljs-comment">// Print the current status of the account</span>
        printStatus(forAccount: account, completionHandler: <span class="hljs-literal">nil</span>)

        <span class="hljs-comment">// Get the minimum fee required to send a transaction</span>
        kinClient.minFee()
                .then { (fee) <span class="hljs-keyword">in</span>
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Minimum fee \(fee)"</span>)
                }
                .error { (error: <span class="hljs-type">Error</span>) <span class="hljs-keyword">in</span>
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error getting the minimum fee \(error)"</span> )
                }


        <span class="hljs-comment">// We use here the asynchronous version of the methods to get the status, and depending on the status (whether</span>
        <span class="hljs-comment">// the account has been created on the blockchain or not) we create it on the blockchain, fund it, and</span>
        <span class="hljs-comment">// send a transaction, or just print the balance and send a transaction.</span>

        <span class="hljs-comment">// Get the status of the account</span>
        account.status { (status: <span class="hljs-type">AccountStatus?</span>, error: <span class="hljs-type">Error?</span>) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> status = status <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span>
            }

            <span class="hljs-keyword">switch</span> status {

            <span class="hljs-keyword">case</span> .notCreated:
                <span class="hljs-comment">// The account has just been created locally. It needs to be added to the blockchain</span>

                <span class="hljs-comment">// We create that account on the playground blockchain</span>
                <span class="hljs-keyword">self</span>.createAccountOnPlaygroundBlockchain(account: account) { (result: [<span class="hljs-type">String</span> : <span class="hljs-type">Any</span>]?) <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">guard</span> result != <span class="hljs-literal">nil</span> <span class="hljs-keyword">else</span> {
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"The account has not been created"</span>)
                        <span class="hljs-keyword">return</span>
                    }
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Account was created successfully"</span>)

                    <span class="hljs-comment">// Get the balance on the account</span>
                    <span class="hljs-keyword">self</span>.getBalance(forAccount: account) { kin <span class="hljs-keyword">in</span>
                        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> kin = kin,
                              kin &gt; <span class="hljs-number">0.0</span> <span class="hljs-keyword">else</span> {
                            <span class="hljs-built_in">print</span>(<span class="hljs-string">"No Kin available in this account"</span>)
                            <span class="hljs-keyword">return</span>
                        }
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"The account has \(kin) Kin"</span>)

                        <span class="hljs-comment">// Print the account's status again</span>
                        <span class="hljs-keyword">self</span>.printStatus(forAccount: account, completionHandler: <span class="hljs-literal">nil</span>)

                        <span class="hljs-comment">// Sends some kinds to another account</span>
                        <span class="hljs-keyword">let</span> toAddress = <span class="hljs-string">"GBGOKDBB3PABAGJV233C3LVBIO5HFQUUSML4FTXYCHW2VCEU4QLYL2II"</span>
                        <span class="hljs-keyword">self</span>.sendTransaction(fromAccount: account,
                                toAddress: toAddress,
                                kinAmount: <span class="hljs-number">5</span>,
                                memo: <span class="hljs-string">"Testing transaction"</span>,
                                fee: <span class="hljs-number">1</span>) { txId <span class="hljs-keyword">in</span>
                            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-number">_</span> = txId <span class="hljs-keyword">else</span> {
                                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error sending transaction"</span>)
                                <span class="hljs-keyword">return</span>
                            }
                            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Kin were sent successfully!!!!!"</span>)

                            <span class="hljs-comment">// Get the balance after the transaction</span>
                            <span class="hljs-keyword">self</span>.getBalance(forAccount: account) { kin <span class="hljs-keyword">in</span>
                                <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> kin = kin <span class="hljs-keyword">else</span> {
                                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error getting the balance"</span>)
                                    <span class="hljs-keyword">return</span>
                                }
                                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Now the balance is \(kin) Kin"</span>)
                            }
                        }
                    }
                }

            <span class="hljs-keyword">case</span> .created:
                <span class="hljs-comment">// The account exists on the blockchain - We can send transactions (provided there are enough Kin)</span>

                <span class="hljs-comment">// Get the balance</span>
                <span class="hljs-keyword">self</span>.getBalance(forAccount: account) { kin <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> kin = kin,
                          kin &gt; <span class="hljs-number">0.0</span> <span class="hljs-keyword">else</span> {
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"No Kin in this account"</span>)
                        <span class="hljs-keyword">return</span>
                    }
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"The account is created and can send Kin with a balance of \(kin) Kin"</span>)
                    <span class="hljs-keyword">let</span> toAddress = <span class="hljs-string">"GBGOKDBB3PABAGJV233C3LVBIO5HFQUUSML4FTXYCHW2VCEU4QLYL2II"</span>
                    <span class="hljs-keyword">self</span>.sendWhitelistTransaction(fromAccount: account,
                            toAddress: toAddress,
                            kinAmount: <span class="hljs-number">4</span>,
                            memo: <span class="hljs-string">"Test"</span>,
                            fee: <span class="hljs-number">0</span>) { txId <span class="hljs-keyword">in</span>
                        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-number">_</span> = txId <span class="hljs-keyword">else</span> {
                            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error sending whitelist transaction"</span>)
                            <span class="hljs-keyword">return</span>
                        }
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Kin were sent successfully using a whitelist transaction !!!!!"</span>)

                        <span class="hljs-keyword">self</span>.getBalance(forAccount: account) { kin <span class="hljs-keyword">in</span>
                            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> kin = kin <span class="hljs-keyword">else</span> {
                                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error getting the balance"</span>)
                                <span class="hljs-keyword">return</span>
                            }
                            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Now the balance is \(kin) Kin"</span>)
                        }
                    }
                }
            }
        }

        <span class="hljs-comment">// Exports the account to a JSON string with the given passphrase. You can later import the account with the</span>
        <span class="hljs-comment">// same passphrase and the JSON string.</span>
        <span class="hljs-keyword">let</span> json = <span class="hljs-keyword">try</span>! account.export(passphrase: <span class="hljs-string">"a-secret-passphrase-here"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Exported JSON \n\(json)\n"</span>)
    }

    <span class="hljs-comment">/**
    Initializes the Kin Client with the playground environment.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initializeKinClientOnPlaygroundNetwork</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">KinClient?</span> {
        <span class="hljs-keyword">let</span> url = <span class="hljs-string">"http://horizon-testnet.kininfrastructure.com"</span>
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> providerUrl = <span class="hljs-type">URL</span>(string: url) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> }

        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">let</span> appId = <span class="hljs-keyword">try</span> <span class="hljs-type">AppId</span>(<span class="hljs-string">"test"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-type">KinClient</span>(with: providerUrl, network: .testNet, appId: appId)
        }
        <span class="hljs-keyword">catch</span> <span class="hljs-keyword">let</span> error {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error \(error)"</span>)
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }

    <span class="hljs-comment">/**
    Returns the first account stored on the client. The account status will tell whether the account also exists
    on the blockchain or not.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getFirstAccount</span><span class="hljs-params">(kinClient: KinClient)</span></span> -&gt; <span class="hljs-type">KinAccount?</span> {
        <span class="hljs-keyword">return</span> kinClient.accounts.first
    }

    <span class="hljs-comment">/**
    Create a local stored account (does not created it on the blockchain)
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createLocalAccount</span><span class="hljs-params">(kinClient: KinClient)</span></span> -&gt; <span class="hljs-type">KinAccount?</span> {
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">let</span> account = <span class="hljs-keyword">try</span> kinClient.addAccount()
            <span class="hljs-keyword">return</span> account
        }
        <span class="hljs-keyword">catch</span> <span class="hljs-keyword">let</span> error {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error creating an account \(error)"</span>)
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }

    <span class="hljs-comment">/**
    Delete the first stored account of the client.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deleteFirstAccount</span><span class="hljs-params">(kinClient: KinClient)</span></span> {
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">try</span> kinClient.deleteAccount(at: <span class="hljs-number">0</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"First stored account deleted!"</span>)
        }
        <span class="hljs-keyword">catch</span> <span class="hljs-keyword">let</span> error {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not delete account \(error)"</span>)
        }
    }

    <span class="hljs-comment">/**
    Get the balance using the method with callback.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getBalance</span><span class="hljs-params">(forAccount account: KinAccount, completionHandler: <span class="hljs-params">(<span class="hljs-params">(Kin?)</span></span></span></span> -&gt; ())?) {
        account.balance { (balance: <span class="hljs-type">Kin?</span>, error: <span class="hljs-type">Error?</span>) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> error != <span class="hljs-literal">nil</span> || balance == <span class="hljs-literal">nil</span> {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error getting the balance"</span>)
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error { <span class="hljs-built_in">print</span>(<span class="hljs-string">"with error: \(error)"</span>) }
                completionHandler?(<span class="hljs-literal">nil</span>)
                <span class="hljs-keyword">return</span>
            }
            completionHandler?(balance!)
        }
    }

    <span class="hljs-comment">/**
    Watch for the creation of the account. This simply prints a message.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">watchCreation</span><span class="hljs-params">(forAccount account: KinAccount)</span></span> {
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">let</span> watch = <span class="hljs-keyword">try</span> account.watchCreation()
            watch.then { (<span class="hljs-number">_</span>) <span class="hljs-keyword">in</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Account creation watcher update: was created (watch)"</span>)
            }
        }
        <span class="hljs-keyword">catch</span> <span class="hljs-keyword">let</span> error {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error watching account creation \(error)"</span>)
        }
    }

    <span class="hljs-comment">/**
    Watch the balance. This simply prints a message when the balance has changed.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">watchBalance</span><span class="hljs-params">(forAccount account: KinAccount)</span></span> {
        <span class="hljs-keyword">let</span> watch = <span class="hljs-keyword">try</span>! account.watchBalance(<span class="hljs-literal">nil</span>)
        watch.emitter.on { (balance: <span class="hljs-type">Kin</span>) <span class="hljs-keyword">in</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"The account's balance has changed: \(balance)"</span>)
        }
    }

    <span class="hljs-comment">/**
    Get the status of the account using the callback method.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printStatus</span><span class="hljs-params">(forAccount account: KinAccount,
                     completionHandler: <span class="hljs-params">(<span class="hljs-params">(AccountStatus?)</span></span></span></span> -&gt; ())?) {
        account.status { (status: <span class="hljs-type">AccountStatus?</span>, error: <span class="hljs-type">Error?</span>) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> error != <span class="hljs-literal">nil</span> || status == <span class="hljs-literal">nil</span> {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error getting status"</span>)
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error { <span class="hljs-built_in">print</span> (<span class="hljs-string">"with error: \(error)"</span>) }
                completionHandler?(<span class="hljs-literal">nil</span>)
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Account's status: \(status!)"</span>)
            completionHandler?(status!)
        }
    }

    <span class="hljs-comment">/**
    Create the given stored account on the playground blockchain. When on the Playground blockchain, the account
    is funded with 10000 Kin automatically.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createAccountOnPlaygroundBlockchain</span><span class="hljs-params">(account: KinAccount,
                                             completionHandler: @escaping <span class="hljs-params">(<span class="hljs-params">([String: <span class="hljs-keyword">Any</span>]?)</span></span></span></span> -&gt; ())) {
        <span class="hljs-comment">// Playground blockchain URL for account creation</span>
        <span class="hljs-keyword">let</span> createUrlString = <span class="hljs-string">"http://friendbot-testnet.kininfrastructure.com?addr=\(account.publicAddress)"</span>

        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> createUrl = <span class="hljs-type">URL</span>(string: createUrlString) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }

        <span class="hljs-keyword">let</span> request = <span class="hljs-type">URLRequest</span>(url: createUrl)
        <span class="hljs-keyword">let</span> task = <span class="hljs-type">URLSession</span>.shared.dataTask(with: request) { (data: <span class="hljs-type">Data?</span>, response: <span class="hljs-type">URLResponse?</span>, error: <span class="hljs-type">Error?</span>) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Account creation on playground blockchain failed with error: \(error)"</span>)
                completionHandler(<span class="hljs-literal">nil</span>)
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> data = data,
                  <span class="hljs-keyword">let</span> json = <span class="hljs-keyword">try</span>? <span class="hljs-type">JSONSerialization</span>.jsonObject(with: data, options: []),
                  <span class="hljs-keyword">let</span> result = json <span class="hljs-keyword">as</span>? [<span class="hljs-type">String</span>: <span class="hljs-type">Any</span>] <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Account creation on playground blockchain failed with no parsable JSON"</span>)
                completionHandler(<span class="hljs-literal">nil</span>)
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-comment">// check if there's a bad status</span>
            <span class="hljs-keyword">guard</span> result[<span class="hljs-string">"status"</span>] == <span class="hljs-literal">nil</span> <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error status \(result)"</span>)
                completionHandler(<span class="hljs-literal">nil</span>)
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Account creation on playground blockchain was successful with response data: \(result)"</span>)
            completionHandler(result)
        }

        task.resume()
    }

    <span class="hljs-comment">/**
    Sends a transaction to the given account.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendTransaction</span><span class="hljs-params">(fromAccount account: KinAccount,
                         toAddress address: String,
                         kinAmount kin: Kin,
                         memo: String?,
                         fee: Stroop,
                         completionHandler: <span class="hljs-params">(<span class="hljs-params">(String?)</span></span></span></span> -&gt; ())?) {
        <span class="hljs-comment">// Get a transaction envelope object</span>
        account.generateTransaction(to: address, kin: kin, memo: memo, fee: fee) { (envelope, error) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> error != <span class="hljs-literal">nil</span> || envelope == <span class="hljs-literal">nil</span> {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not generate the transaction"</span>)
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error { <span class="hljs-built_in">print</span>(<span class="hljs-string">"with error: \(error)"</span>)}
                completionHandler?(<span class="hljs-literal">nil</span>)
                <span class="hljs-keyword">return</span>
            }

            <span class="hljs-comment">// Sends the transaction</span>
            account.sendTransaction(envelope!) { (txId, error) <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">if</span> error != <span class="hljs-literal">nil</span> || txId == <span class="hljs-literal">nil</span> {
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error send transaction"</span>)
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"with error: \(error)"</span>)
                    }
                    completionHandler?(<span class="hljs-literal">nil</span>)
                    <span class="hljs-keyword">return</span>
                }
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Transaction was sent successfully for \(kin) Kin - id: \(txId!)"</span>)
                completionHandler?(txId!)
            }
        }
    }

    <span class="hljs-comment">/**
    Sends a transaction to the given account.
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sendWhitelistTransaction</span><span class="hljs-params">(fromAccount account: KinAccount,
                                  toAddress address: String,
                                  kinAmount kin: Kin,
                                  memo: String?,
                                  fee: Stroop,
                                  completionHandler: <span class="hljs-params">(<span class="hljs-params">(String?)</span></span></span></span> -&gt; ())?) {
        <span class="hljs-comment">// Get a transaction envelope object</span>
        account.generateTransaction(to: address, kin: kin, memo: memo, fee: fee) { (envelope, error) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> error != <span class="hljs-literal">nil</span> || envelope == <span class="hljs-literal">nil</span> {
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"Could not generate the transaction"</span>)
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"with error: \(error)"</span>)
                }
                completionHandler?(<span class="hljs-literal">nil</span>)
                <span class="hljs-keyword">return</span>
            }

            <span class="hljs-keyword">let</span> networkId = <span class="hljs-type">Network</span>.testNet.id
            <span class="hljs-keyword">let</span> whitelistEnvelope = <span class="hljs-type">WhitelistEnvelope</span>(transactionEnvelope: envelope!, networkId: networkId)

            <span class="hljs-keyword">self</span>.signWhitelistTransaction(whitelistServiceUrl: <span class="hljs-string">"WHITELIST_SERVICE_URL"</span>,
                    envelope: whitelistEnvelope) { (signedEnvelope, error) <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">if</span> error != <span class="hljs-literal">nil</span> || signedEnvelope == <span class="hljs-literal">nil</span> {
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error whitelisting the envelope"</span>)
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"with error: \(error)"</span>)
                    }
                    completionHandler?(<span class="hljs-literal">nil</span>)
                    <span class="hljs-keyword">return</span>
                }
                <span class="hljs-comment">// send the whitelist transaction</span>
                account.sendTransaction(signedEnvelope!) { (txId, error) <span class="hljs-keyword">in</span>
                    <span class="hljs-keyword">if</span> error != <span class="hljs-literal">nil</span> || txId == <span class="hljs-literal">nil</span> {
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Error send whitelist transaction"</span>)
                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> error = error {
                            <span class="hljs-built_in">print</span>(<span class="hljs-string">"with error: \(error)"</span>)
                        }
                        completionHandler?(<span class="hljs-literal">nil</span>)
                        <span class="hljs-keyword">return</span>
                    }
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Whitelist transaction was sent successfully for \(kin) Kin - id: \(txId!)"</span>)
                    completionHandler?(txId!)
                }

            }
        }
    }

    <span class="hljs-comment">/**
    Sign the given transaction envelope so that the transaction can be submitted with the fee waived
    */</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">signWhitelistTransaction</span><span class="hljs-params">(whitelistServiceUrl: String,
                                  envelope: WhitelistEnvelope,
                                  completionHandler: @escaping <span class="hljs-params">(<span class="hljs-params">(TransactionEnvelope?, Error?)</span></span></span></span> -&gt; ())) {
        <span class="hljs-keyword">let</span> whitelistingUrl = <span class="hljs-type">URL</span>(string: whitelistServiceUrl)!

        <span class="hljs-keyword">var</span> request = <span class="hljs-type">URLRequest</span>(url: whitelistingUrl)
        request.addValue(<span class="hljs-string">"application/json"</span>, forHTTPHeaderField: <span class="hljs-string">"Content-Type"</span>)
        request.httpMethod = <span class="hljs-string">"POST"</span>
        request.httpBody = <span class="hljs-keyword">try</span>? <span class="hljs-type">JSONEncoder</span>().encode(envelope)

        <span class="hljs-keyword">let</span> task = <span class="hljs-type">URLSession</span>.shared.dataTask(with: request) { (data, response, error) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">do</span> {
                <span class="hljs-keyword">let</span> envelope = <span class="hljs-keyword">try</span> <span class="hljs-type">TransactionEnvelope</span>.decodeResponse(data: data, error: error)
                completionHandler(envelope, <span class="hljs-literal">nil</span>)
            }
            <span class="hljs-keyword">catch</span> {
                completionHandler(<span class="hljs-literal">nil</span>, error)
            }
        }
        task.resume()
    }

}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer id="footer"><section class="content"><div id="footer-logo"><a href="/kin-website-docs/"><img src="/kin-website-docs/img/logo-black-k.svg" alt="Kin SDK Docs" width="53" height="53"/></a></div><div id="footer-col-1" class="footer-links"><h4>Docs</h4><a href="/kin-website-docs/docs/kin-architecture-overview">Introduction</a><a href="/kin-website-docs/docs/quick-start/hi-kin-android">Quickstart</a><a href="/kin-website-docs/docs/documentation/android-sdk">Android</a><a href="/kin-website-docs/docs/documentation/ios-sdk">iOS</a><a href="/kin-website-docs/docs/documentation/python-sdk">Python</a></div><div id="footer-col-2" class="footer-links"><h4>Resources</h4><a href="https://kin.org/developers/downloads">Downloads</a><a href="https://kinsupport.zendesk.com">Support</a></div><div id="footer-col-3" class="footer-links"><h4>Community</h4><a href="https://kin.org/developers/events/">Events</a></div><div id="footer-social"><a href="https://twitter.com/kin_foundation" target="_blank" rel="noreferrer noopener"><img src="/kin-website-docs/img/linkedin.svg" alt="LinkedIn" width="29" height="29"/></a><a href="https://www.reddit.com/r/KinFoundation/" target="_blank" rel="noreferrer noopener"><img src="/kin-website-docs/img/reddit.svg" alt="Reddit" width="29" height="29"/></a><a href="https://medium.com/kinblog" target="_blank" rel="noreferrer noopener"><img src="/kin-website-docs/img/medium.svg" alt="Medium" width="29" height="29"/></a></div><div id="footer-privacy"><a href="https://kin.org/privacy-policy.pdf" target="_blank">Privacy policy</a><a href="https://kin.org/terms-and-conditions.pdf" target="_blank">Terms and conditions</a></div><div id="footer-copyright">© 2019 Kin Foundation</div></section></footer></div></body></html>